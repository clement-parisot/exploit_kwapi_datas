#!/bin/sh
# Generate node list of Reims site
oarnodes -l > all_nodes.txt
begin=1451602800
end=1467237600
for n in $(cat all_nodes.txt);
do
  # Short uid in node variable
  node="echo $n| awk -F '.' '{print $1}'"
  echo "Export $n"
  # Get json file from kwapi API
  curl "http://kwapi.reims.grid5000.fr:12000/power/timeseries/?from=$begin&to=$end&only=$node" | gzip > $node.json.zip;
done;
echo "All files are imported locally. Unzip those files to exploit the datas."
ls -l *.zip
